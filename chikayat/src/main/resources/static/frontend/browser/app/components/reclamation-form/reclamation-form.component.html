<div class="container">
  <h2>ุฅูุดุงุก ุดูุงูุฉ</h2>

  <form [formGroup]="reclamationForm" (ngSubmit)="submitForm()">
    <div class="mb-3">
      <label for="pieceJointeReclamation">ููู ุงูุดูุงูุฉ :</label>
      <input type="file" id="pieceJointeReclamation" class="form-control" (change)="onFileSelected($event)">
    </div>
    <div class="ms-2">
      <button type="button" class="btn btn-secondary btn-sm" (click)="convertImageToText()">
        ุชุญููู ุงูุตูุฑุฉ ุฅูู ูุต
      </button>
    </div>
    <!-- ูุงูุฐุฉ ูุนุฑุถ ุงููุต ุงููุณุชุฎุฑุฌ -->
    <div class="modal fade" id="ocrModal" tabindex="-1" aria-labelledby="ocrModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="ocrModalLabel">ูุต ุงูุตูุฑุฉ</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ุฅุบูุงู"></button>
          </div>
          <div class="modal-body">
            <textarea class="form-control" rows="10" readonly>{{ ocrText }}</textarea>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" (click)="copyOcrText()">ูุณุฎ ุงููุต</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅุบูุงู</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ุฑูู ุงูุชุณุฌูู ูุงููุฑุฌุน -->
    <div class="mb-3">
      <label for="numInscription">ุฑูู ุงูุชุณุฌูู :</label>
      <input type="text" id="numInscription" dir="ltr" class="form-control" formControlName="numInscription" [attr.disabled]="true">
    </div>

    <div class="mb-3">
      <label for="referenceBo">ูุฑุฌุน ุงูุงุณุชูุงู :</label>
      <input type="text" id="referenceBo" dir="ltr" class="form-control" formControlName="referenceBo">
    </div>
    <div class="mb-3">
      <label for="dateDepot">ุชุงุฑูุฎ ุงูุฅูุฏุงุน :</label>
      <input type="date" id="dateDepot" class="form-control" formControlName="dateDepot">
    </div>
    <div class="mb-3">
      <label for="annee">ุงูุณูุฉ :</label>
      <input type="number" id="annee" class="form-control" formControlName="annee">
    </div>

    <div class="mb-3">
      <label for="observation1">ููุงุญุธุฉ :</label>
      <input type="text" id="observation1" class="form-control" formControlName="observation1">
    </div>

    <!-- ุงูุฃูุณุงู ุงููุทููุฉ -->
    <div class="accordion" id="reclamationAccordion">
      <!-- ุงููุนูููุงุช ุงูุดุฎุตูุฉ -->
      <div class="accordion-item">
        <h2 class="accordion-header">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
            ๐ง ุงููุนูููุงุช ุงูุดุฎุตูุฉ
          </button>
        </h2>
        <div id="collapseOne" class="accordion-collapse collapse show">
          <div class="accordion-body">
            <div class="mb-3">
              <label for="typeIdentifiant">ููุน ุงููุนุฑู :</label>
              <select id="typeIdentifiant" class="form-select" formControlName="typeIdentifiant">
                <option value="CIN">ุจุทุงูุฉ ุงููููุฉ</option>
                <option value="Passeport">ุฌูุงุฒ ุงูุณูุฑ</option>
                <option value="Carte de sรฉjour">ุจุทุงูุฉ ุงูุฅูุงูุฉ</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="identifiant">ุงููุนุฑู :</label>
              <input type="text" id="identifiant" class="form-control" formControlName="identifiant" required (blur)="checkReclamations()">
              <div *ngIf="reclamationCount > 0" class="mt-2">
                <a href="javascript:void(0)" (click)="openReclamationsModal()">
                  ุนุฏุฏ ุงูุทูุจุงุช ุงููุงุฑุฏุฉ ููุฐุง ุงูุดุฎุต: {{ reclamationCount }}
                </a>
              </div>
            

              


            </div>
            <div class="mb-3">
              <label for="nomComplet">ุงูุงุณู ุงููุงูู :</label>
              <input type="text" id="nomComplet" class="form-control" formControlName="nomComplet" required>
            </div>
    <!-- ุงูุญููู ุงูุฅุถุงููุฉ -->
    <div class="mb-3">
      <label for="adresse">ุงูุนููุงู :</label>
      <input type="text" id="adresse" class="form-control" formControlName="adresse">
    </div>

    <div class="mb-3">
      <label for="telephone">ุฑูู ุงููุงุชู :</label>
      <input type="tel" id="telephone" formControlName="telephone" pattern="[0-9]{10}" placeholder="ุฃุฏุฎู ุฑูููุง ูููููุง ูู 10 ุฃุฑูุงู" class="form-control" #telephoneInput>
      <!-- ุนุฑุถ ุฑุณุงูุฉ ุงูุฎุทุฃ ุฅุฐุง ูุงู ุงูุชูุณูู ุบูุฑ ุตุญูุญ -->
      <div *ngIf="reclamationForm.get('telephone')?.invalid && (reclamationForm.get('telephone')?.touched || reclamationForm.get('telephone')?.dirty)" class="text-danger">
        ุชูุณูู ุงููุงุชู ุบูุฑ ุตุญูุญ!
      </div>
    </div>

 
          </div>
        </div>
      </div>

      <!-- ุชูุงุตูู ุงูุดูุงูุฉ -->
      <div class="accordion-item">
        <h2 class="accordion-header">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
            ๐ ุชูุงุตูู ุงูุดูุงูุฉ
          </button>
        </h2>
        <div id="collapseTwo" class="accordion-collapse collapse show">
          <div class="accordion-body">
            <div class="mb-3">
              <label for="commune">ุงููููุฐ ุงูุชุฑุงุจู :</label>
              <select id="commune" class="form-select" formControlName="commune">
                <option *ngFor="let commune of communes" [value]="commune">{{ commune }}</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="typeRequete">ููุน ุงูุทูุจ :</label>
              <select id="typeRequete" class="form-select" formControlName="typeRequete">
                <option *ngFor="let typeRequete of typeRequetes" [value]="typeRequete.id">{{ typeRequete.nomLangue2 }}</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="typeReclamation">ููุน ุงูุดูุงูุฉ :</label>
              <select id="typeReclamation" class="form-select" formControlName="typeReclamation">
                <option *ngFor="let typeReclamation of typeReclamations" [value]="typeReclamation.id">{{ typeReclamation.nomLangue2 }}</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="sourceReclamation">ูุตุฏุฑ ุงูุดูุงูุฉ :</label>
              <select id="sourceReclamation" class="form-select" formControlName="sourceReclamation">
                <option *ngFor="let sourceReclamation of sourceReclamations" [value]="sourceReclamation.id">{{ sourceReclamation.nomLangue2 }}</option>
              </select>
            </div>            
            <div class="mb-3">
              <label for="objetReclamation">ููุถูุน ุงูุดูุงูุฉ :</label>
              <textarea id="objetReclamation" class="form-control" formControlName="objetReclamation"></textarea>
            </div>
            <div class="mb-3">
              <label for="objetReclamation">ุชุนูููุงุช ุณูุฏ ุงูุนุงูู :</label>
              <textarea id="instructionsGouverneur" class="form-control" formControlName="instructionsGouverneur"></textarea>
            </div>           

            <div class="mb-3">
              <label for="typeDestinataire">ููุน ุงูุฌูุฉ :</label>
              <select id="typeDestinataire" class="form-select" formControlName="typeDestinataire">
                <option *ngFor="let typeDestinataire of typeDestinataires" [value]="typeDestinataire.id">{{ typeDestinataire.nomLangue2 }}</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="destinataire">ุงูุฌูุฉ :</label>
              <input type="text" id="destinataire" class="form-control" formControlName="destinataire">
            </div>
          </div>
        </div>
      </div>
    </div>

    <button type="submit" class="btn btn-primary mt-3" [disabled]="reclamationForm.invalid">
      ๐จ ุฅุฑุณุงู ุงูุดูุงูุฉ
    </button>
  </form>

  <div *ngIf="successMessage" class="alert alert-success mt-3">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="alert alert-danger mt-3">{{ errorMessage }}</div>
</div>

<div class="modal fade" id="reclamationsModal" tabindex="-1" aria-labelledby="reclamationsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl"> <!-- Utilisation de modal-xl pour agrandir -->
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="reclamationsModalLabel">ุงูุทูุจุงุช ุงููุงุฑุฏุฉ ููุฐุง ุงูุดุฎุต</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ุฅุบูุงู"></button>
      </div>
      <div class="modal-body" style="max-height: 500px; overflow-y: auto;">
        <div class="table-responsive">
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>ุฑูู ุงูุชุณุฌูู</th>
                <th>ุชุงุฑูุฎ ุงูุฅูุฏุงุน</th>
                <th>ุงูุงุณู ุงููุงูู</th>
                <th>ููุถูุน ุงูุดูุงูุฉ</th>
                <th>ููุน ุงูุดูุงูุฉ</th>
                <th>ููุน ุงูุทูุจ</th>
                <th>ุฅุฑุณุงู ุงูุฌูุฉ ุงููุฎุชุตุฉ</th>
                <th>ุนูุฏุฉ ุงูุฌูุฉ ุงููุฎุชุตุฉ</th>
                <th>ุฅุฑุณุงู ุงูุฑุฏ</th>
                <th>ุชุนูููุงุช</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let rec of reclamations">
                <td>{{ rec.numInscription }}</td>
                <td>{{ rec.dateDepot | date:'dd/MM/yyyy' }}</td>
                <td>{{ rec.nomComplet }}</td>
                <td>{{ rec.objetReclamation }}</td>
                <td>{{ rec.typeReclamationLabel }}</td>
                <td>{{ rec.typeRequeteLabel }}</td>
                <td>{{ rec.flagEnvoiAutoriteText }}</td>
                <td>{{ rec.flagRetourAutoriteText }}</td>
                <td>{{ rec.flagEnvoiReclamantText }}</td>
                <td>{{ rec.instructionsGouverneur }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅุบูุงู</button>
      </div>
    </div>
  </div>
</div>
